{% extends 'base.html' %} {% load static %} {% block 'title'%}Projetos{%endblock%} {% block 'head' %}
<link rel="stylesheet" href="{% static 'css/full-style.css' %}" />
<style>
  #form-etapas .form-etapa {
    display: none;
  }

  #form-etapas .form-etapa.ativo {
    display: block;
  }
  label.form-label {
    color: #012970 !important;
  }
  th.ocultar,
  td.ocultar {
    display: none;
  }
  .table-dot tbody {
    display: block; /* Permite que o tbody seja rolável */
    max-height: 10em; /* Define a altura máxima */
    overflow-y: auto; /* Permite a rolagem vertical quando necessário */
  }
  
  .table-dot thead, .table-dot tbody tr {
    display: table; /* Faz com que o thead e tr se comportem como uma tabela */
    width: 100%; /* Faz com que o thead e tr ocupem a largura total da tabela */
    table-layout: fixed; /* Garante que as células da tabela sejam de largura igual */
  }
</style>
{% endblock %} {% block 'subtitle' %}Pacote aquisição - {{name_project}}{% endblock %} {% block 'content' %}
{% if messages %} {% for message in messages %}
<div class="alert {{message.tags}} stilo-message">{{message}}</div>
{% endfor %} {% endif %}
<div class="row align-items-top">
  <!-- Fase Card -->
  <div class="col">
    <div class="card info-card revenue-card">
      <div class="card-body">
        <div class="row align-items-top">
          <form id="form-etapas" action="{% url 'createpackage' id_project %}" method="POST">
            {% csrf_token %}
            <!-- Etapa 1 -->
            <div class="form-etapa ativo">
              <h5 class="card-title border-bottom">
                Andamento
                <span>| Informações gerais do pacote</span>
                <button type="reset" onclick="clearSession()" class="btn btn-secondary btn-sm ms-sm-5"><i class="bi bi-eraser"></i></button>
              </h5>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->  
                <div class="row align-items-top">
                  <div class="col">
                    <div class="card info-card revenue-card">
                      <div class="card-body">
                        <h5 class="card-title">
                          TITULO <span>| Escolha um titulo para identificar seu pacote</span>
                        </h5>
                        <div class="d-flex align-items-center">
                          <input
                          type="text"
                          class="form-control mb-0 changeble-item"
                          placeholder=""
                          aria-label="Local"
                          aria-describedby="basic-addon1"
                          id="inputTitlePacote"
                          name="inputTitlePacote"
                        />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row align-items-top">
                  <!-- Status Card -->
                  <div class="col-xxl-6 col-md-6">
                    <div class="card info-card revenue-card">
                      <div class="card-body">
                        <h5 class="card-title">
                          FASE <span>| Informe o andamento do projeto</span>
                        </h5>
                        <div class="d-flex align-items-center">
                          <select
                            class="form-select changeble-item"
                            aria-label="Default select example"
                            id = "selectStatusNew"
                            name = "selectStatusNew"
                          >
                            <option selected disabled>
                              Escolha o Status do projeto
                            </option>
                            <option value="PJ">Planejamento</option>
                            <option value="RP">RP em andamento</option>
                            <option value="PG">PG em andamento</option>
                            <option value="EMP">Empenhado</option>
                            <option value="AGE">Aguardando entrega</option>
                            <option value="ENT">Entregue</option>
                            <option value="INS">Instalado</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- End Status Card -->
                  <!-- Fase Card -->
                  <div class="col-xxl-6 col-md-6">
                    <div class="card info-card revenue-card">
                      <div class="card-body">
                        <h5 class="card-title">
                          ESPECIFICA
                          <span
                            >| Especifique a fase caso tenha escolhido RP ou
                            PG</span
                          >
                        </h5>
                        <div class="d-flex align-items-center">
                          <select
                            class="form-select changeble-item"
                            id="selectnewrp"
                            name="selectnewrp"
                            aria-label="Default select example"
                          >
                            <option selected disabled value="">
                              Escolha a fase do RP
                            </option>
                            <option value="rp-etp">Elaboração do ETP</option>
                            <option value="rp-orcamentos">
                              Obtenção de Orçamentos
                            </option>
                            <option value="rp-precos">Mapa de Preços</option>
                            <option value="rp-autorizacao-dlf">
                              Pedido de autorização DLF
                            </option>
                            <option value="rp-gestao">
                              Solicitação de Gestão de RP
                            </option>
                            <option value="rp-minuta">
                              Elaboração Minuta do Termo de Referência
                            </option>
                            <option value="rp-correcao-minuta">
                              Correção Minuta do Termo de Referência (ASSJUR)
                            </option>
                            <option value="rp-correcao-etp">
                              Correção ETP (ASSJUR)
                            </option>
                            <option value="rp-formulario-adesao">
                              Formulário de Adesão
                            </option>
                            <option value="rp-encaminhado-gol">
                              Encaminhado a Gol
                            </option>
                            <option value="rp-impugnacao">
                              Respondendo impugnação
                            </option>
                            <option value="rp-resposta-documentacao">
                              Resposta a documentação
                            </option>
                          </select>
                          <select
                            class="form-select changeble-item"
                            id="selectnewpg"
                            name="selectnewpg"
                            aria-label="Default select example"
                          >
                            <option selected disabled value="">
                              Escolha a fase do PG
                            </option>
                            <option value="pg-autorizacao-dlf">
                              Pedido de autorização DLF
                            </option>
                            <option value="pg-etp">Elaboração do ETP</option>
                            <option value="pg-orcamentos">
                              Obtenção de Orçamentos
                            </option>
                            <option value="pg-precos">Mapa de Preços</option>
                            <option value="pg-minuta">
                              Elaboração Minuta do Termo de Referência
                            </option>
                            <option value="pg-extrato">
                              Extrato de Crédito
                            </option>
                            <option value="pg-correcao-minuta">
                              Correção Minuta do Termo de Referência (ASSJUR)
                            </option>
                            <option value="pg-correcao-etp">
                              Correção ETP (ASSJUR)
                            </option>
                          </select>
                          <div
                            id="terceiros"
                            class="fw-bold text-primary h5"
                            name="terceiros"
                          >
                            terceiros
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>

                <div class="row align-items-top">
                  <!-- Natureza Card -->
                  <div class="col-xxl-6 col-md-6">
                    <div class="card info-card revenue-card">
                      <div class="card-body">
                        <h5 class="card-title">
                          Etiqueta
                          <span>| Classifique a Etiqueta do projeto</span>
                        </h5>
                        <div class="d-flex align-items-center">
                          <select
                            class="form-select changeble-item"
                            aria-label="Default select example"
                            id="selectEtiquetaNew"
                            name="selectEtiquetaNew"
                          >
                            <option selected disabled>
                              Escolha a Etiqueta projeto
                            </option>
                            <option value="radio">Radiocomunicação</option>
                            <option value="telefonia">Telefonia</option>
                            <option value="audioevideo">Audio e video</option>
                            <option value="outros">Outros</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- TIPO Card -->
                  <div class="col-xxl-6 col-md-6">
                    <div class="card info-card revenue-card">
                      <div class="card-body">
                        <h5 class="card-title">
                          NATUREZA
                          <span
                            >| Natureza a ser fornecido se material ou serviço</span
                          >
                        </h5>
                        <div class="d-flex align-items-center">
                          <select
                            class="form-select changeble-item"
                            aria-label="Default select example"
                            id="selectNaturezaNew"
                            name="selectNaturezaNew"
                          >
                            <option selected disabled>Escolha o Tipo</option>
                            <option value="material">Material</option>
                            <option value="servico">Serviço</option>
                            <option value="materialservico">Material/Serviço</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
                <!--Fim Conteudo-->
              </div>
              <!-- Fim Etapa 1 -->
              <button
                class="btn btn-outline-success btn-next mt-4"
                type="button"
              >
                Próximo
              </button>
            </div>
            <!-- Etapa 2 -->
            <div class="form-etapa">
              <h5 class="card-title border-bottom">
                Documentos
                <span>| Documentação de referencia ao projeto</span>
                <button type="reset" onclick="clearSession()" class="btn btn-secondary btn-sm ms-sm-5"><i class="bi bi-eraser"></i></button>
              </h5>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->
                <div class="row align-items-top">
                  <!-- CONTRATO Card -->
                  <div class="col-xxl-4 col-md-4">
                    <div class="card info-card revenue-card">
                      <div class="card-body">
                        <h5 class="card-title">
                          CONTRATO <span>| Nº do Contrato do Pacote</span>
                        </h5>
                        <div class="d-flex align-items-center">
                          <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"
                              >Nº</span
                            >
                            <input
                              type="text"
                              class="form-control mb-0 changeble-item"
                              placeholder="Contrato"
                              aria-label="Local"
                              aria-describedby="basic-addon1"
                              id="inputContratoNew"
                              name="inputContratoNew"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- End CONTRATO Card -->
                  <!-- DATA INICIO Card -->
                  <div class="col-xxl-4 col-md-4">
                    <div class="card info-card revenue-card">
                      <div class="card-body">
                        <h5 class="card-title">
                          DATA INICIAL <span>| Início da Vigência</span>
                        </h5>
                        <div class="d-flex align-items-center">
                          <div class="mb-3">
                            <input
                              type="date"
                              class="form-control changeble-item"
                              id="dateInitialInput"
                              name="dateInitialInput"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- End DATA INICIO Card -->
                  <!-- DATA FINAL Card -->
                  <div class="col-xxl-4 col-md-4">
                    <div class="card info-card revenue-card">
                      <div class="card-body">
                        <h5 class="card-title">
                          DATA FINAL <span>| Início da Vigência</span>
                        </h5>
                        <div class="d-flex align-items-center">
                          <div class="mb-3">
                            <input
                              type="date"
                              class="form-control changeble-item"
                              id="dateFinalInput"
                              name="dateFinalInput"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- End DATA FINAL Card -->
                  <!-- LOCALIZADO Card -->
                  <div class="col-xxl-6 col-md-6">
                    <div class="card info-card revenue-card">
                      <div class="card-body">
                        <h5 class="card-title">
                          SEI <span>| Numero de documento referência</span>
                        </h5>
                        <div class="d-flex flex-column align-items-center">
                          <div class="input-group mb-3">
                            <button
                              class="btn btn-primary fw-bold"
                              type="button"
                              id="button-addon1-new"
                            >
                              +
                            </button>
                            <input
                              type="text"
                              class="form-control"
                              id="inputText-new"
                              placeholder=""
                              aria-label="Example text with button addon"
                              aria-describedby="button-addon1-new"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- End LOCALIZADO Card -->
                  <!-- LOCALIZADO Card -->
                  <div class="col-xxl-6 col-md-6">
                    <div class="card info-card revenue-card">
                      <div class="card-body">
                        <div class="d-flex flex-column align-items-center">
                          <div
                            class="list-container d-flex flex-column justify-content-around w-100 changeble-item"
                            id="listContainer-new"
                            style="height: 8.8em; overflow-y: auto"
                          ></div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- input que deve ser escontido -->
                  <input
                    type="text"
                    class="form-control changeble-item"
                    name="hiddensei"
                    id="hiddensei"
                    value=""
                  />
                  <!-- End LOCALIZADO Card -->
                </div>
                <!--Fim Conteudo-->
              </div>
              <!-- Fim Etapa 2 -->
              <button
                class="btn btn-outline-success btn-prev mt-4"
                type="button"
              >
                Voltar
              </button>
              <button
                class="btn btn-outline-success btn-next mt-4"
                type="button"
              >
                Próximo
              </button>
            </div>
            <!-- Etapa 3 -->
            <div class="form-etapa">
              <h5 class="card-title border-bottom">
                EQUIPAMENTOS/SERVIÇOS
                <span>| Equipamentos e/ou Serviços que compoem o pacote</span>
                <button type="reset" onclick="clearSession()" class="btn btn-secondary btn-sm ms-sm-5"><i class="bi bi-eraser"></i></button>
              </h5>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->
                <div class="col-xxl-6 col-md-6">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        Categoria
                        <span>| Selecione a categoria desejada</span>
                      </h5>
                      <div class="d-flex align-items-center">
                        <select
                          class="form-select changeble-item"
                          aria-label="Default select example"
                          id="selectCategoria"
                          name="selectCategoria"
                        >
                          <option selected disabled>Escolha a categoria</option>
                          <option value="equipamento">Equipamento</option>
                          <option value="servico">Serviço</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xxl-6 col-md-6">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        SELECIONAR
                        <span>| Selecione o equipamento/serviço na lista</span>
                      </h5>
                      <div class="d-flex align-items-center">
                        <select
                          class="form-select changeble-item"
                          aria-label="Default select example"
                          id="selectEquip"
                          name="selectEquip"
                        >
                          <option selected disabled>
                            Escolha o equipamento/serviço
                          </option>
                          {% for equipamento in equipamentos %}
                          <option
                            value="{{equipamento.id}}-{{equipamento.classe}}"
                          >
                            {{equipamento.titulo}}
                          </option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xxl-12 col-md-12">
                  <div class="line-container">
                    <div class="line"></div>
                    <span
                      class="span-line"
                      style="font-size: 14px; font-weight: normal"
                      >Não encontrou o equipamento/serviço?</span
                    >
                    <div class="line"></div>
                  </div>
                </div>
                <div class="col-xxl-12 col-md-12">
                  <div class="d-flex justify-content-center align-items-center">
                    <button
                      type="button"
                      class="btn btn-primary fw-bold w-50 p-2 my-2"
                      data-bs-toggle="modal"
                      data-bs-target="#modalCreateEquip"
                    >
                      Criar Novo Equipamento/Serviço
                    </button>
                  </div>
                </div>
                <!--Fim Conteudo-->
              </div>

              <div class="row align-items-top">
                <div class="col-xxl-4 col-md-4">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        LOCAL
                        <span>| Local onde o equipamento se encontra</span>
                      </h5>
                      <div class="d-flex flex-column align-items-center">
                        <div class="input-group mb-3">
                          <button
                            class="btn btn-primary fw-bold"
                            type="button"
                            id="button-addon1-new"
                          ></button>
                          <input
                            type="text"
                            class="form-control changeble-item"
                            id="inputLocnew"
                            placeholder=""
                            aria-label="Example text with button addon"
                            aria-describedby="button-addon1-new"
                            value=""
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xxl-4 col-md-4">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        DESTINO <span>| Para onde será destinado</span>
                      </h5>
                      <div class="d-flex flex-column align-items-center">
                        <div class="input-group mb-3">
                          <button
                            class="btn btn-primary fw-bold"
                            type="button"
                            id="button-addon1-new"
                          ></button>
                          <input
                            type="text"
                            class="form-control changeble-item"
                            id="inputDestnew"
                            placeholder=""
                            aria-label="Example text with button addon"
                            aria-describedby="button-addon1-new"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xxl-4 col-md-4">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        QUANTIDADE <span>| Equpamentos para mesmo destino</span>
                      </h5>
                      <div class="d-flex flex-column align-items-center">
                        <div class="input-group mb-3">
                          <button
                            class="btn btn-primary fw-bold"
                            type="button"
                            id="button-addon1-new"
                          ></button>
                          <input
                            type="number"
                            class="form-control changeble-item"
                            id="inputQtnew"
                            placeholder=""
                            aria-label="Example text with button addon"
                            aria-describedby="button-addon1-new"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->
                <div class="col-xxl-12 col-md-12">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        VALORES
                        <span>| Valores obtidos para calculo de preço</span>
                      </h5>
                      <div class="d-flex flex-column align-items-center">
                        <!--MAIN CONTENT-->
                        <div class="row w-100">
                          <div class="col-md-4">
                            <label
                              for="val1Item"
                              class="form-label text-primary"
                              >Valor 1</label
                            >
                            <input
                              type="text"
                              id="val1Item"
                              class="form-control changeble-item"
                              name="val1Item"
                              oninput="formatToCurrency(this)"
                              onchange="calcMedia()"
                            />
                          </div>
                          <div class="col-md-4">
                            <label
                              for="val2Item"
                              class="form-label text-primary"
                              >Valor 2</label
                            >
                            <input
                              type="text"
                              id="val2Item"
                              class="form-control changeble-item"
                              name="val2Item"
                              oninput="formatToCurrency(this)"
                              onchange="calcMedia()"
                            />
                          </div>
                          <div class="col-md-4">
                            <label
                              for="val3Item"
                              class="form-label text-primary"
                              >Valor 3</label
                            >
                            <input
                              type="text"
                              id="val3Item"
                              class="form-control changeble-item"
                              name="val3Item"
                              oninput="formatToCurrency(this)"
                              onchange="calcMedia()"
                            />
                          </div>
                        </div>
                        <div class="row w-100 mt-4">
                          <div class="col-md-6">
                            <label
                              for="valMedItem"
                              class="form-label text-primary"
                              >Valor Media</label
                            >
                            <input
                              type="text"
                              id="valMedItem"
                              class="form-control changeble-item"
                              name="valMedItem"
                              oninput="formatToCurrency(this)"
                            />
                          </div>
                          <div class="col-md-6">
                            <label
                              for="valMedItem"
                              class="form-label text-primary"
                              >Valor Portal</label
                            >
                            <div class="form-check form-switch">
                              <input
                                class="form-check-input changeble-item"
                                type="checkbox"
                                id="flexSwitchCheckDefault"
                              />
                              <label
                                class="form-check-label"
                                for="flexSwitchCheckDefault"
                                >Usar valor padrão do portal </label
                              ><br /><label id="equipamentoValorPortal"
                                >Valor:
                              </label>
                            </div>
                          </div>
                        </div>
                        <!--MAIN CONTENT-->
                      </div>
                    </div>
                  </div>
                </div>
                <!--Fim Conteudo-->
              </div>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->
                <div class="col-xxl-12 col-md-12">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        STATUS
                        <span>| Status das entregas dos equipamentos</span>
                      </h5>
                      <div class="d-flex align-items-center">
                        <!--MAIN CONTENT-->
                        <div class="row w-50">
                          <div class="col-12">
                            <select
                              class="form-select changeble-item"
                              aria-label="Default"
                              id="statusItem"
                              name="statusItem"
                              required
                            >
                              <option selected disabled>Status do item</option>
                              <option value="demanda">Demanda</option>
                              <option value="licitacao">Licitacao</option>
                              <option value="aentregar">A entregar</option>
                              <option value="entregue">Entregue</option>
                              <option value="ainstalar">A instalar</option>
                              <option value="instalado">Instalado</option>
                            </select>
                          </div>
                        </div>
                        <!--MAIN CONTENT-->
                      </div>
                    </div>
                  </div>
                </div>

                <!--Fim Conteudo-->
              </div>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->
                <div class="col-xxl-12 col-md-12">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        DATAS
                        <span>| Datas relevantes no andamento do projeto</span>
                      </h5>
                      <div class="d-flex align-items-center">
                        <!--MAIN CONTENT-->
                        <div class="row w-100">
                          <div class="col-md-6">
                            <label
                              for="dateEntEquip"
                              class="form-label text-primary"
                              >Entrega</label
                            >
                            <input
                              type="date"
                              class="form-control changeble-item"
                              id="dateEntEquip"
                              name="dateEntEquip"
                            />
                          </div>
                          <div class="col-md-6">
                            <label
                              for="dateInsEquip"
                              class="form-label text-primary"
                              >Instalação</label
                            >
                            <input
                              type="date"
                              class="form-control changeble-item"
                              id="dateInsEquip"
                              name="dateInsEquip"
                            />
                          </div>
                        </div>
                        <!--MAIN CONTENT-->
                      </div>
                    </div>
                  </div>
                </div>
                <!--Fim Conteudo-->
              </div>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->
                <div class="col-xxl-12 col-md-12">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        OBSERVAÇÕES
                        <span>| Observações relevantes ao pacote</span>
                      </h5>
                      <div class="d-flex align-items-center">
                        <!--MAIN CONTENT-->
                        <div class="row w-100">
                          <div class="col-md-12">
                            <label for="obsItem" class="form-label text-primary"
                              >Observações</label
                            >
                            <textarea
                              class="form-control changeble-item"
                              style="height: 130px; font-size: 0.8em"
                              id="obsItem"
                              name="obsItem"
                            ></textarea>
                          </div>
                        </div>
                        <!--MAIN CONTENT-->
                      </div>
                    </div>
                  </div>
                </div>
                <!--Fim Conteudo-->
              </div>
              <div class="row align-items-center">
                <div
                  class="col-xxl-12 col-md-12 w-80 d-flex justify-content-center align-items-center"
                >
                  <button
                    type="button"
                    class="btn btn-success fw-bold mb-4"
                    onclick="insereRowTable()"
                  >
                    Adicionar Equipamento
                  </button>
                </div>
              </div>
              <!-- Inicio Colunas -->
              <div class="row align-items-top">
                <div class="col-xxl-12 col-md-12">
                  <div class="line-container">
                    <div class="line"></div>
                    <span class="span-line">Equipamentos</span>
                    <div class="line"></div>
                  </div>
                </div>
                <div class="col-xxl-12 col-md-12">
                  <div class="card">
                    <div class="card-body">
                      <!-- Tabela de Equipamentos -->
                      <table
                        id="main-table"
                        class="table table-striped table-sm table-dot"
                      >
                        <thead>
                          <tr>
                            <th scope="col" class="rot-info rot-sm">Titulo</th>
                            <th scope="col" class="rot-info rot-sm ocultar">
                              Di
                            </th>
                            <th scope="col" class="rot-info rot-sm">Classe</th>
                            <th scope="col" class="rot-info rot-sm">Tipo</th>
                            <th scope="col" class="rot-info rot-sm">Status</th>
                            <th scope="col" class="rot-info rot-sm ocultar">
                              Val1
                            </th>
                            <th scope="col" class="rot-info rot-sm ocultar">
                              Val2
                            </th>
                            <th scope="col" class="rot-info rot-sm ocultar">
                              Val3
                            </th>
                            <th scope="col" class="rot-info rot-sm ocultar">
                              Val Media
                            </th>
                            <th scope="col" class="rot-info rot-sm ocultar">
                              BolValor
                            </th>
                            <th scope="col" class="rot-info rot-sm">Valor</th>
                            <th scope="col" class="rot-info rot-sm">Qtd Un</th>
                            <th scope="col" class="rot-info rot-sm">
                              Qtd Total
                            </th>
                            <th scope="col" class="rot-info rot-sm ocultar">
                              Local
                            </th>
                            <th scope="col" class="rot-info rot-sm ocultar">
                              Dt Ent
                            </th>
                            <th scope="col" class="rot-info rot-sm ocultar">
                              Dt Inst
                            </th>
                            <th scope="col" class="rot-info rot-sm ocultar">
                              Obs
                            </th>
                            <th scope="col" class="rot-info rot-sm">Destino</th>
                            <th scope="col" class="rot-info rot-sm">Ações</th>
                          </tr>
                        </thead>
                        <tbody>
                        </tbody>
                      </table>
                      <!-- End Table with stripped rows -->
                    </div>
                  </div>
                </div>
              </div>
              <input
              type="text"
              class="form-control"
              name="hiddenequipser"
              id="hiddenequipser"
              value=""
            />
              <button
                class="btn btn-outline-success btn-prev mt-4"
                type="button"
              >
                Voltar
              </button>
              <button
                class="btn btn-outline-success btn-next mt-4"
                type="button"
              >
                Próximo
              </button>
            </div>
            <!-- Etapa 4 -->
            <div class="form-etapa">
              <h5 class="card-title border-bottom">
                CRONOGRAMA
                <span>| Crie um cronograma para compor seu pacote</span>
                <button type="reset" onclick="clearSession()" class="btn btn-secondary btn-sm ms-sm-5"><i class="bi bi-eraser"></i></button>
              </h5>
              <div class="row align-items-top">
                <div class="col-xxl-12 col-md-12">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        TITULO
                        <span>| Identificação de seu cronograma</span>
                      </h5>
                      <div class="d-flex flex-column align-items-center">
                        <div class="input-group mb-3">
                          <button
                            class="btn btn-primary fw-bold"
                            type="button"
                            id="button-addon1-new"
                          ></button>
                          <input
                            type="text"
                            class="form-control changeble-item"
                            id="inputTitleCron"
                            name="inputTitleCron"
                            placeholder=""
                            aria-label="Example text with button addon"
                            aria-describedby="button-addon1-new"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->
                <div class="col-xxl-12 col-md-12">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        DESCRIÇÃO
                        <span>| Faça uma breve descrição do cronograma</span>
                      </h5>
                      <div class="d-flex align-items-center">
                        <!--MAIN CONTENT-->
                        <div class="row w-100">
                          <div class="col-md-12">
                            <textarea
                              class="form-control changeble-item"
                              style="height: 130px; font-size: 0.8em"
                              id="desCron"
                              name="desCron"
                            ></textarea>
                          </div>
                        </div>
                        <!--MAIN CONTENT-->
                      </div>
                    </div>
                  </div>
                </div>
                <!--Fim Conteudo-->
              </div>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->
                <div class="col-xxl-12 col-md-12">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        Observações
                        <span>| Observações relevantes ao projeto</span>
                      </h5>
                      <div class="d-flex align-items-center">
                        <!--MAIN CONTENT-->
                        <div class="row w-100">
                          <div class="col-md-12">
                            <textarea
                              class="form-control changeble-item"
                              style="height: 130px; font-size: 0.8em"
                              id="obsCron"
                              name="obsCron"
                            ></textarea>
                          </div>
                        </div>
                        <!--MAIN CONTENT-->
                      </div>
                    </div>
                  </div>
                </div>
                <!--Fim Conteudo-->
              </div>
              <div class="row align-items-center">
                <div
                  class="col-xxl-12 col-md-12 w-80 d-flex justify-content-center align-items-center"
                >
                  <button
                    type="button"
                    class="btn btn-success fw-bold mb-4"
                    data-bs-toggle="modal"
                    data-bs-target="#modalAddTask"
                  >
                    Adicionar Tarefas
                  </button>
                </div>
              </div>
              <!-- Inicio Colunas -->
              <div class="row align-items-top">
                <div class="col-xxl-12 col-md-12">
                  <div class="line-container">
                    <div class="line"></div>
                    <span class="span-line">Tarefas</span>
                    <div class="line"></div>
                  </div>
                </div>
                <div class="col-xxl-12 col-md-12">
                  <div class="card">
                    <div class="card-body">
                      <!-- Table with stripped rows -->
                      <table id="listTaskTable" class="table table-striped table-sm table-dot">
                        <thead>
                          <tr>
                            <th scope="col" class="rot-info rot-sm">Tarefa</th>
                            <th scope="col" class="rot-info rot-sm ocultar">Descrição</th>
                            <th scope="col" class="rot-info rot-sm">Status</th>
                            <th scope="col" class="rot-info rot-sm">Prioridade</th>
                            <th scope="col" class="rot-info rot-sm ocultar">Início P</th>
                            <th scope="col" class="rot-info rot-sm ocultar">Fim P</th>
                            <th scope="col" class="rot-info rot-sm ocultar">Inicio R</th>
                            <th scope="col" class="rot-info rot-sm ocultar">Fim R</th>
                            <th scope="col" class="rot-info rot-sm">Inicio</th>
                            <th scope="col" class="rot-info rot-sm">Fim</th>
                            <th scope="col" class="rot-info rot-sm">Duração(dias)</th>
                            <th scope="col" class="rot-info rot-sm ocultar">Observações</th>
                            <th scope="col" class="rot-info rot-sm">Ações</th>
                          </tr>
                        </thead>
                        <tbody class="changeble-item">

                        </tbody>
                      </table>
                      <!-- End Table with stripped rows -->
                    </div>
                  </div>
                </div>
              </div>
              <input
              type="text"
              class="form-control changeble-item"
              name="hiddentasks"
              id="hiddentasks"
              value=""
            />
              <button
                class="btn btn-outline-success btn-prev mt-4"
                type="button"
              >
                Voltar
              </button>
              <button
                class="btn btn-outline-success btn-next mt-4"
                type="button"
              >
                Próximo
              </button>
            </div>
            <!-- Etapa 5 -->
            <div class="form-etapa">
              <h5 class="card-title border-bottom">
                OBSERVAÇÕES E PENDÊNCIAS
                <span>| Registre todas as obsevações e pendencias do projeto</span>
                <button type="reset" onclick="clearSession()" class="btn btn-secondary btn-sm ms-sm-5"><i class="bi bi-eraser"></i></button>
              </h5>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->
                <div class="col-xxl-12 col-md-12">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        DESCRIÇÃO
                        <span>| Faça uma breve descrição da sua observação ou pendencia</span>
                      </h5>
                      <div class="d-flex align-items-center">
                        <!--MAIN CONTENT-->
                        <div class="row w-100">
                          <div class="col-md-12">
                            <textarea
                              class="form-control changeble-item"
                              style="height: 130px; font-size: 0.8em"
                              id="descObsPen"
                              name="descObsPen"
                            ></textarea>
                          </div>
                        </div>
                        <!--MAIN CONTENT-->
                      </div>
                    </div>
                  </div>
                </div>
                <!--Fim Conteudo-->
              </div>
              <div class="row align-items-top">
                <!--Inicio Conteudo-->
                <div class="col-xxl-6 col-md-6">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        CATEGORIA
                        <span>| Selecione a categoria do registro</span>
                      </h5>
                      <div class="d-flex align-items-center">
                        <select
                          class="form-select changeble-item"
                          aria-label="Default select example"
                          id="selectCategoriaObsPen"
                        >
                          <option selected disabled>Escolha a categoria</option>
                          <option value="pendencia">Pendência</option>
                          <option value="observacao">Observação</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xxl-6 col-md-6">
                  <div class="card info-card revenue-card">
                    <div class="card-body">
                      <h5 class="card-title">
                        DATA
                        <span>| Informe a data ou pendencia da reclamação</span>
                      </h5>
                      <div class="d-flex align-items-center">
                        <input type="date" class="form-control changeble-item" id="dateObsPen" name="dateObsPen" />
                      </div>
                    </div>
                  </div>
                </div>
                <!--Fim Conteudo-->
              </div>
              <div class="row align-items-center">
                <div
                  class="col-xxl-12 col-md-12 w-80 d-flex justify-content-center align-items-center"
                >
                  <button
                    type="button"
                    class="btn btn-success fw-bold mb-4"
                    onclick="insereObsPen()"
                  >
                    Adicionar Observação/Pendencia
                  </button>
                </div>
              </div>
              <!-- Inicio Colunas -->
              <div class="row align-items-top">
                <div class="col-xxl-12 col-md-12">
                  <div class="line-container">
                    <div class="line"></div>
                    <span class="span-line">Tarefas</span>
                    <div class="line"></div>
                  </div>
                </div>
                <div class="col-xxl-12 col-md-12">
                  <div class="card">
                    <div class="card-body">
                      <!-- Table with stripped rows -->
                      <table id="listObsPenTable" class="table table-striped table-sm table-dot">
                        <thead>
                          <tr>
                            <th scope="col" class="rot-info rot-sm">Descrição</th>
                            <th scope="col" class="rot-info rot-sm">Categoria</th>
                            <th scope="col" class="rot-info rot-sm">Data</th>
                            <th scope="col" class="rot-info rot-sm">Ações</th>
                          </tr>
                        </thead>
                        <tbody class="changeble-item">

                        </tbody>
                      </table>
                      <!-- End Table with stripped rows -->
                    </div>
                  </div>
                </div>
              </div>
              <input
              type="text"
              class="form-control changeble-item"
              name="hiddenobspend"
              id="hiddenobspend"
              value=""
            />
              <!-- Fim Etapa 3 -->
              <button
                class="btn btn-outline-success btn-prev mt-4"
                type="button"
              >
                Voltar
              </button>
              <button
                class="btn btn-success btn-submit mt-4 ms-5"
                type="submit"
                style="margin-left: 5em !important; width: 70%"
              >
                Cadastrar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
  <!-- Modal Dialog Scrollable -->
  <div class="modal fade" id="modalCreateEquip" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold">Criar Novo Equipamento</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <form action="{% url 'createequipserv' id_project %}" method="post">
            {% csrf_token %}
            <div class="container">
              <div class="row py-2">
                <div class="col-md-12">
                  <label for="titleItem" class="form-label text-primary"
                    >Titulo</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="titleItem"
                    name="titleItem"
                    required
                  />
                </div>
              </div>
              <div class="row py-2">
                <div class="col-md-12">
                  <label for="especItem" class="form-label text-primary"
                    >Especificação</label
                  >
                  <textarea
                    class="form-control"
                    style="height: 130px; font-size: 0.8em"
                    id="especItem"
                    name="especItem"
                    required
                  ></textarea>
                </div>
              </div>
              <div class="row py-2">
                <div class="col-md-12">
                  <label for="categoryItem" class="form-label text-primary"
                    >Categoria</label
                  >
                  <select
                    class="form-select"
                    aria-label="Default"
                    id="categoryItem"
                    name="categoryItem"
                    required
                  >
                    <option selected disabled>Escolha a Categoria</option>
                    <option value="equipamento">Equipamento</option>
                    <option value="servico">ServiÇo</option>
                  </select>
                </div>
              </div>
              <div class="row py-2">
                <div class="col-md-6">
                  <label for="rpCode" class="form-label text-primary"
                    >Registro de Preço</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="rpCode"
                    name="rpCode"
                  />
                </div>
                <div class="col-md-6">
                  <label for="itemCode" class="form-label text-primary"
                    >Código Item</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="itemCode"
                    name="itemCode"
                  />
                </div>
              </div>
              <div class="row py-2">
                <div class="col-md-6">
                  <label for="elItem" class="form-label text-primary"
                    >Elemento Item</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="elItem"
                    name="elItem"
                    maxlength="4"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label for="classItem" class="form-label text-primary"
                    >Classe</label
                  >
                  <select
                    class="form-select"
                    aria-label="Default"
                    id="classItem"
                    name="classItem"
                    required
                  >
                    <option selected disabled>Escolha a Classe</option>
                    <option value="consumo">Consumo</option>
                    <option value="permanente">Permanente</option>
                  </select>
                </div>
              </div>
              <div class="row py-2">
                <div class="col-md-6">
                  <label for="valPortItem" class="form-label text-primary"
                    >Valor Portal</label
                  >
                  <input
                    type="text"
                    id="valPortItem"
                    class="form-control"
                    name="valPortItem"
                    oninput="formatToCurrency(this)"
                  />
                </div>
                <div class="col-md-6">
                  <label for="sitItem" class="form-label text-primary"
                    >Situação</label
                  >
                  <select
                    class="form-select"
                    aria-label="Default"
                    id="sitItem"
                    name="sitItem"
                    required
                  >
                    <option selected disabled>Situação do item</option>
                    <option value="ativo">Ativo</option>
                    <option value="inativo">Inativo</option>
                    <option value="suspenso">Suspenso</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-danger"
                data-bs-dismiss="modal"
              >
                Cancelar
              </button>
              <!-- Cria botão limpar-->
              <button type="reset" class="btn btn-warning">Limpar</button>
              <button type="submit" class="btn btn-success w-50">Criar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
<!-- End Modal Dialog Scrollable-->
<!-- Modal Cronograma Scrollable -->
<div class="modal fade" id="modalAddTask" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold">Adicionar Nova Tarefa</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form id="formAddTask">
          {% csrf_token %}
          <div class="container">
            <div class="row py-2">
              <div class="col-md-12">
                <label for="titleTask" class="form-label text-primary"
                  >Titulo</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="titleTask"
                  name="titleTask"
                  required
                />
              </div>
            </div>
            <div class="row py-2">
              <div class="col-md-12">
                <label for="descTask" class="form-label text-primary"
                  >Descrição</label
                >
                <textarea
                  class="form-control"
                  style="height: 130px; font-size: 0.8em"
                  id="descTask"
                  name="descTask"
                  required
                ></textarea>
              </div>
            </div>
            <div class="row py-2">
              <div class="col-md-6">
                <label for="statusTask" class="form-label text-primary"
                  >Status</label
                >
                <select
                  class="form-select"
                  aria-label="Default"
                  id="statusTask"
                  name="statusTask"
                  required
                >
                  <option selected disabled>Escolha o Status</option>
                  <option value="pendente">Pendente</option>
                  <option value="emexecucao">Em execução</option>
                  <option value="concluido">Concluído</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="priorTask" class="form-label text-primary"
                  >Prioridade</label
                >
                <select
                  class="form-select"
                  aria-label="Default"
                  id="priorTask"
                  name="priorTask"
                  required
                >
                  <option selected disabled>Escolha a Categoria</option>
                  <option value="baixa">Baixa</option>
                  <option value="media">Média</option>
                  <option value="alta">Alta</option>
                </select>
              </div>
            </div>
            <div class="row py-2">
              <div class="col-md-6">
                <label for="initPlanTask" class="form-label text-primary"
                  >Inicio Planejado</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="initPlanTask"
                  name="initPlanTask"
                />
              </div>
              <div class="col-md-6">
                <label for="endPlanTask" class="form-label text-primary"
                  >Fim Planejado</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="endPlanTask"
                  name="endPlanTask"
                />
              </div>
            </div>
            <div class="row py-2">
              <div class="col-md-6">
                <label for="initRealTask" class="form-label text-primary"
                  >Inicio Real</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="initRealTask"
                  name="initRealTask"
                />
              </div>
              <div class="col-md-6">
                <label for="endRealTask" class="form-label text-primary"
                  >Fim Real</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="endRealTask"
                  name="endRealTask"
                />
              </div>
            </div>
            <div class="row py-2">
              <div class="col-md-12">
                <label for="obsTask" class="form-label text-primary"
                  >Observações</label
                >
                <textarea
                  class="form-control"
                  style="height: 130px; font-size: 0.8em"
                  id="obsTask"
                  name="obsTask"
                  required
                ></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-danger"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <!-- Cria botão limpar-->
            <button type="reset" class="btn btn-warning">Limpar</button>
            <button type="submit" class="btn btn-success w-50">Criar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- End Modal Cronograma Scrollable-->
<script>
  // Função que seleciona a classe qual select ou div fica hidden (selectnewrp, selectnewpg ou terceiros) dependendo da option do select de id = selectStatusNew
  function setEspecificaForFase(){
    if(sessionStorage.getItem("selectStatusNew") == "PG"){
      document.getElementById("selectnewpg").style.display = "block";
      document.getElementById("selectnewrp").style.display = "none";
      document.getElementById("terceiros").style.display = "none";
    }else if(sessionStorage.getItem("selectStatusNew") == "RP"){
      document.getElementById("selectnewpg").style.display = "none";
      document.getElementById("selectnewrp").style.display = "block";
      document.getElementById("terceiros").style.display = "none";
    }else{
      document.getElementById("selectnewpg").style.display = "none";
      document.getElementById("selectnewrp").style.display = "none";
      document.getElementById("terceiros").style.display = "block";
    }
  }

  const refreshitem = document.querySelectorAll(".changeble-item");

  refreshitem.forEach((item) => {
    item.addEventListener("change", (e) => {
      console.log(e.target.id);
      if(e.target.id == "selectStatusNew"){
        if(e.target.value == "PG"){
          sessionStorage.setItem(e.target.id, e.target.value);
          sessionStorage.setItem("selectnewpg", "");
        }else if(e.target.value == "RP"){
          sessionStorage.setItem(e.target.id, e.target.value);
          sessionStorage.setItem("selectnewrp", "");
          
        }else{
          sessionStorage.setItem(e.target.id, e.target.value);
          sessionStorage.setItem("selectnewrp", "terceiros");
        }
      }else{
        sessionStorage.setItem(e.target.id, e.target.value);
      }
    });
  });

  document.getElementById('formAddTask').addEventListener('submit', function(e) {
    // Impedir o envio do formulário
    e.preventDefault();
  
    // Recuperar os dados de todos os campos do formulario
    titulotask = document.querySelector("#titleTask").value;
    desctask = document.querySelector("#descTask").value;
    statustask = document.querySelector("#statusTask").value;
    priortask = document.querySelector("#priorTask").value;
    initplantask = document.querySelector("#initPlanTask").value;
    endplantask = document.querySelector("#endPlanTask").value;
    initrealtask = document.querySelector("#initRealTask").value;
    endrealtask = document.querySelector("#endRealTask").value;
    obstask = document.querySelector("#obsTask").value;

    dataInicial = initrealtask ? initrealtask : initplantask;
    dataFinal = endrealtask ? endrealtask : endplantask;

    // cria uma tr a ser inserida dentro do tbody da tabela de id = listTaskTable
    const tbodytask = document.getElementById("listTaskTable").getElementsByTagName("tbody")[0];
    const rowtask = tbodytask.insertRow();
    rowtask.innerHTML = `
    <td  class="rot-info rot-sm">${titulotask}</td>
    <td  class="rot-info rot-sm ocultar">${desctask}</td>
    <td  class="rot-info rot-sm">${statustask}</td>
    <td  class="rot-info rot-sm">${priortask}</td>
    <td  class="rot-info rot-sm ocultar">${initplantask}</td>
    <td  class="rot-info rot-sm ocultar">${endplantask}</td>
    <td  class="rot-info rot-sm ocultar">${initrealtask}</td>
    <td  class="rot-info rot-sm ocultar">${endrealtask}</td>
    <td  class="rot-info rot-sm">${dataInicial}</td>
    <td  class="rot-info rot-sm">${dataFinal}</td>
    <td  class="rot-info rot-sm">${calcularDiferencaDias(dataInicial, dataFinal)}</td>
    <td  class="rot-info rot-sm ocultar">${obstask}</td>
    <td><button type="button" class="btn btn-danger btn-sm task" onclick="removeRow(this)"><i class="ri-delete-bin-6-line"></i></button></td>`;

    // Fecha o modal após o processamento do formulário
    var myModal = bootstrap.Modal.getInstance(document.getElementById('modalAddTask'));
    myModal.hide();
    setCronoSession()

  });

  window.addEventListener('load', function() {
    document.getElementById('form-etapas').reset();
    getAllValues()
  });


  document.addEventListener('DOMContentLoaded', function() {
    var selectCategoria = document.getElementById('selectCategoria');
    var selectEquip = document.getElementById('selectEquip');


    selectCategoria.addEventListener('change', function(){
      // Limpa as opções existentes
      selectEquip.innerHTML = '';

      // Adiciona a opção "disabled" no início
      var defaultOption = document.createElement('option');
      defaultOption.setAttribute('selected', '');
      defaultOption.setAttribute('disabled', '');
      defaultOption.innerText = 'Escolha o equipamento/serviço';
      selectEquip.appendChild(defaultOption);

      // Adiciona as opções correspondentes ao tipo selecionado
      {% for equipamento in equipamentos %}
        if ('{{equipamento.tipo}}' == selectCategoria.value) {
          var option = document.createElement('option');
          option.value = "{{equipamento.id}}-{{equipamento.classe}}";
          option.innerText = "{{equipamento.titulo}}";
          selectEquip.appendChild(option);
        }
      {% endfor %}
    });

    selectEquip.addEventListener('change', function(){
      var equipamentoIdClasse = this.value.split('-');
      var equipamentoId = equipamentoIdClasse[0];

      {% for equipamento in equipamentos %}
        if ("{{equipamento.id}}" == equipamentoId) {
          document.getElementById('equipamentoValorPortal').innerText = 'Valor: R$ ' + '{{equipamento.valor_portal}}';
          return;
        }
      {% endfor %}
    });

    var etapas = Array.from(
      document.querySelectorAll("#form-etapas .form-etapa")
    );
    var count = etapas.length;
    var current = 0;
  
    var btnsNext = Array.from(document.querySelectorAll(".btn-next"));
    var btnsPrev = Array.from(document.querySelectorAll(".btn-prev"));
  
    // Ao carregar a página, verifique se há uma etapa armazenada em sessionStorage
    var savedStep = sessionStorage.getItem('currentStep');
    if (savedStep) {
      // Se houver, use-o como a etapa atual e exiba a etapa correta
      current = parseInt(savedStep, 10);
      etapas.forEach((etapa, index) => {
        if (index === current) {
          etapa.classList.add("ativo");
        } else {
          etapa.classList.remove("ativo");
        }
      });
    }
  
    btnsNext.forEach((btn) => {
      btn.addEventListener("click", function () {
        if (current < count - 1) {
          etapas[current].classList.remove("ativo");
          current++;
          // Quando o usuário avança, salve a etapa atual em sessionStorage
          sessionStorage.setItem('currentStep', current);
          etapas[current].classList.add("ativo");
        }
      });
    });
  
    btnsPrev.forEach((btn) => {
      btn.addEventListener("click", function () {
        if (current > 0) {
          etapas[current].classList.remove("ativo");
          current--;
          // Quando o usuário retrocede, salve a etapa atual em sessionStorage
          sessionStorage.setItem('currentStep', current);
          etapas[current].classList.add("ativo");
        }
      });
    });

    // Ajusta display para RP, PG e terceiros
    const statusSelect = document.querySelector(".form-select");
    const rpSelect = document.getElementById("selectnewrp");
    const pgSelect = document.getElementById("selectnewpg");
    const terceirosElement = document.getElementById("terceiros");

    // inicia ambos selects ocultos
    rpSelect.style.display = "none";
    pgSelect.style.display = "none";

    statusSelect.addEventListener("change", function () {
      // esconde ambos selects
      rpSelect.style.display = "none";
      pgSelect.style.display = "none";
      terceirosElement.style.display = "block"; // mostra "terceiros"

      if (this.value === "RP") {
        rpSelect.style.display = "block";
        terceirosElement.style.display = "none"; // oculta "terceiros"
      } else if (this.value === "PG") {
        pgSelect.style.display = "block";
        terceirosElement.style.display = "none"; // oculta "terceiros"
      }
    });
    setEspecificaForFase()

  });
  


  document
    .getElementById("button-addon1-new")
    .addEventListener("click", function () {
      const inputText = document.getElementById("inputText-new");
      const listContainer = document.getElementById("listContainer-new");

      // Verifica se o texto já existe na lista
      if (!listContainer.innerHTML.includes(inputText.value)) {
        // Cria um novo item da lista
        const newItem = document.createElement("div");
        newItem.classList.add(
          "d-flex",
          "flex-row",
          "justify-content-between",
          "w-100",
          "align-items-center",
          "mb-1"
        );
        newItem.innerHTML = `<p class="labelsei">${inputText.value}</p> <button class="btn btn-danger btn-sm me-2" onclick="removeItem(event)">X</button>`;

        // Adiciona o novo item à lista
        listContainer.appendChild(newItem);
      }

      // Limpa o campo de entrada
      inputText.value = "";
      setBoxSeiSession()

    });



  function removeItem(event) {
    const item = event.target.parentNode;
    item.parentNode.removeChild(item);
    setBoxSeiSession()
  }
  // Função que será chamada sempre que um elemento for adicionado ou removido de "maincontent"
  // Seleciona o nó que será observado
  const targetNode = document.getElementById("listContainer-new");

  // Cria uma instância de observer
  const observer = new MutationObserver((mutationsList, observer) => {
    // Itera sobre todas as mutações que acabaram de ocorrer
    for (let mutation of mutationsList) {
      // Se o `mutation.type` for `childList`, adiciona o conteúdo do elemento p ao input hidden
      if (mutation.type === "childList") {
        let textValues = "";
        let childDivs = targetNode.children;
        for (let i = 0; i < childDivs.length; i++) {
          // Acessa o conteúdo do elemento p dentro da div
          let pContent =
            childDivs[i].getElementsByTagName("p")[0].textContent;
          textValues += pContent + ";";
        }

        // Remove o último ';'
        textValues = textValues.slice(0, -1);

        // Armazena os valores no input hidden
        document.getElementById("hiddensei").value = textValues;
      }
    }
  });

  // Configuração do observer: quais mutações serão observadas
  const config = { attributes: false, childList: true, subtree: false };
  // Inicia a observação do nó configurado
  observer.observe(targetNode, config);


  function insereRowTable(){

    // Pega o value e o texto do select com id selectEquip
    const selectEquip = document.querySelector("#selectEquip");
    const inputQtd = document.getElementById("inputQtnew").value;
    console.log(inputQtd)
    if (selectEquip.value == "Escolha o equipamento/serviço") {
      alert("A opção SELECIONAR não pode ficar vazia");
      return;
    }else if (inputQtd == undefined || inputQtd == "") {
      alert("A opção QUANTIDADE não pode ficar vazia");
      return;
    }
    // Fazer split no value pela caractere '-' e salvar em id e classe
    const id = selectEquip.value.split("-")[0] ==  "Escolha o equipamento" ? "" : selectEquip.value.split("-")[0];
    const classe = selectEquip.value.split("-")[1] == undefined ? "" : selectEquip.value.split("-")[1];
    const text = selectEquip.options[selectEquip.selectedIndex].text;
    // Pega o texto do option selecionado
    // Pega a categoria
    const selectCategoria = document.querySelector("#selectCategoria").value;
    // Pega LOCAL, DESTINO e QUANTIDADE
    const inputLoc = document.getElementById("inputLocnew").value;
    const inputDest = document.getElementById("inputDestnew").value;

    // Pega VALORES
    const val1Item = document.getElementById("val1Item").value;
    const val2Item = document.getElementById("val2Item").value
    const val3Item = document.getElementById("val3Item").value
    const valMedItem = document.getElementById("valMedItem").value
    const bolPortItem = document.querySelector("#flexSwitchCheckDefault").value == 'on' ? true : false
    const ValPortITem = document.querySelector("#equipamentoValorPortal").textContent
    valPortItem = ValPortITem.replace('Valor:', '')
    console.log(`Valor Portal: ${valPortItem}`)
    const puroValItem = valPortItem.replace('R$ ', '').replace('.', '').replace(',', '.')
    const valtotal = `R$ ${puroValItem * inputQtd}`
    // Pega STATUS e CONTRATO
    const statusItem = document.getElementById("statusItem").value
    // Pega DATAS
    const dateEntEquip = document.getElementById("dateEntEquip").value
    const dateInsEquip = document.getElementById("dateInsEquip").value
    // Pega OBSERVAÇÕES
    const obsItem = document.getElementById("obsItem").value
    // Pega o tbody da tabela de id = main-table, cria uma row, insere cada um dos valores acima em sua respectiva coluna, insere dentro do tbody e limpa todos os campos
    const tbody = document.getElementById("main-table").getElementsByTagName("tbody")[0];
    const row = tbody.insertRow();
    row.innerHTML = `
    <td  class="rot-info rot-sm">${text}</td>
    <td  class="rot-info rot-sm ocultar">${id}</td>
    <td  class="rot-info rot-sm">${classe}</td>
    <td  class="rot-info rot-sm">${selectCategoria}</td>
    <td  class="rot-info rot-sm">${statusItem}</td>
    <td  class="rot-info rot-sm ocultar">${val1Item}</td>
    <td  class="rot-info rot-sm ocultar">${val2Item}</td>
    <td  class="rot-info rot-sm ocultar">${val3Item}</td>
    <td  class="rot-info rot-sm ocultar">${valMedItem}</td>
    <td  class="rot-info rot-sm ocultar">${bolPortItem}</td>
    <td  class="rot-info rot-sm">${valPortItem}</td>
    <td  class="rot-info rot-sm">${inputQtd}</td>
    <td  class="rot-info rot-sm">${valtotal}</td>
    <td  class="rot-info rot-sm ocultar">${inputLoc}</td>
    <td  class="rot-info rot-sm ocultar">${dateEntEquip}</td>
    <td  class="rot-info rot-sm ocultar">${dateInsEquip}</td>
    <td  class="rot-info rot-sm ocultar">${obsItem}</td>
    <td  class="rot-info rot-sm">${inputDest}</td>
    <td><button type="button" class="btn btn-danger btn-sm equipser" onclick="removeRow(this)"><i class="ri-delete-bin-6-line"></i></button></td>`;
  
    setEquipSession();
  }
  function removeRow(btn){
    console.log(btn.classList)
    var row = btn.parentNode.parentNode;
    row.parentNode.removeChild(row);
    if (btn.classList.contains("equipser")) {
      setEquipSession()
    }else if (btn.classList.contains("task")) {
      setCronoSession()
    }else if (btn.classList.contains("obspen")) {
      setObsPenSession()
    }
    

  }
  function calcularDiferencaDias(dataInicial, dataFinal) {
    // Criar objetos Date a partir das strings de data

    if (dataInicial == "" || dataFinal == "") {
      return 0;
    }
    var dateInicial = new Date(dataInicial);
    var dateFinal = new Date(dataFinal);
  
    // Calcular a diferença em milissegundos
    var diferenca = dateFinal.getTime() - dateInicial.getTime();
  
    // Converter a diferença de milissegundos para dias
    var dias = diferenca / (1000 * 3600 * 24);
  
    // Retornar a diferença de dias
    return Math.round(dias);
  }
  function insereObsPen(){
    // Primeiramente pega os valores dos campos DESCRIÇÃO, CATEGORIA e DATA
    const descObsPen = document.getElementById("descObsPen").value
    const selectCategoriaObsPen = document.getElementById("selectCategoriaObsPen").value
    const dateObsPen = document.querySelector("#dateObsPen").value
    
    console.log(`Descrição: ${descObsPen}`)
    console.log(`Categoria: ${selectCategoriaObsPen}`)
    console.log(`Data: ${dateObsPen}`)

    //Seleciona a tabela de id=listObsPenTable e o tbody dela, e então insere a row com os dados
    const tbodyObsPen = document.getElementById("listObsPenTable").getElementsByTagName("tbody")[0];
    const rowObsPen = tbodyObsPen.insertRow();
    rowObsPen.innerHTML = `
    <td  class="rot-info rot-sm">${descObsPen}</td>
    <td  class="rot-info rot-sm">${selectCategoriaObsPen}</td>
    <td  class="rot-info rot-sm">${dateObsPen}</td>
    <td><button type="button" class="btn btn-danger btn-sm obspen" onclick="removeRow(this)"><i class="ri-delete-bin-6-line"></i></button></td>`;

  // Limpa os campos

  document.getElementById("descObsPen").value = ""
  document.getElementById("selectCategoriaObsPen").value = ""
  document.getElementById("dateObsPen").value = ""

  setObsPenSession()
  getAllValues()

}

// Função que gera a string representando o conteúdo da tabela
function generateTableString(idTable) {
  var table = document.getElementById(idTable);
  var rows = Array.from(table.rows).slice(1); // Ignora a primeira linha (cabeçalho)
  var result = rows.map((row) => {
    return Array.from(row.cells).map(cell => cell.textContent).join('|');
  });
  return result.join(';');
}

// Supondo que 'myForm' é o id do seu formulário
var formain = document.getElementById('form-etapas');

formain.addEventListener('submit', function(e) {
  var confirmSubmit = window.confirm('Você tem certeza de que deseja enviar este formulário?');
  if (confirmSubmit) {
    e.preventDefault();
    // Andamento
    const titulo = document.getElementById("inputTitlePacote").value
    const status = document.getElementById("selectStatusNew").value
    const selectnewrp = document.getElementById("selectnewrp").value
    const selectpgnew = document.getElementById("selectnewpg").value
    const etiqueta = document.getElementById("selectEtiquetaNew").value
    const natureza = document.getElementById("selectNaturezaNew").value
    // Documentos
    const contrato = document.getElementById("inputContratoNew").value
    const dataInitCont = document.getElementById("dateInitialInput").value
    const dataFinalCont = document.getElementById("dateFinalInput").value
    const listSei = document.getElementById("hiddensei").value
    // Equipamentos/Servicos
    const equipservice = generateTableString('main-table')
    document.getElementById('hiddenequipser').value = equipservice
    // Cronograma
    const titulocronograma = document.getElementById("inputTitleCron").value
    const descCronograma = document.getElementById("desCron").value
    const obsCronograma = document.getElementById("obsCron").value
    const taksCronograma = generateTableString('listTaskTable')
    document.getElementById('hiddentasks').value = taksCronograma
    // Observações/Pendencias
    const obsPendencias = generateTableString('listObsPenTable')
    document.getElementById('hiddenobspend').value = obsPendencias

    // Faz um print de todos os valores
    console.log(`Titulo: ${titulo}`)
    console.log(`Status: ${status}`)
    console.log(`RP: ${selectnewrp}`)
    console.log(`PG: ${selectpgnew}`)
    console.log(`Etiqueta: ${etiqueta}`)
    console.log(`Natureza: ${natureza}`)
    console.log(`Contrato: ${contrato}`)
    console.log(`Data Inicial Contrato: ${dataInitCont}`)
    console.log(`Data Final Contrato: ${dataFinalCont}`)
    console.log(`SEI: ${listSei}`)
    console.log(`Equipamentos/Serviços: ${equipservice}`)
    console.log(`Título Cronograma: ${titulocronograma}`)
    console.log(`Descrição Cronograma: ${descCronograma}`)
    console.log(`Observações Cronograma: ${obsCronograma}`)
    console.log(`Tarefas Cronograma: ${taksCronograma}`)
    console.log(`Observações/Pendências: ${obsPendencias}`)
    // Faz o submit do formulário

    formain.submit();
  
  }else{
    e.preventDefault();
  }
});
function setEquipSession(){
  const mytablequip = document.querySelector("#main-table>tbody");
  // Pegar o conteudo de tbody e gravar em uma variável de sessão
  console.log(mytablequip.innerHTML)
  sessionStorage.setItem('equipamentos', mytablequip.innerHTML);
}
function setCronoSession(){
  const mytablecrono = document.querySelector("#listTaskTable>tbody");
  // Pegar o conteudo de tbody e gravar em uma variável de sessão
  console.log(mytablecrono.innerHTML)
  sessionStorage.setItem('cronograma', mytablecrono.innerHTML);
}
function setObsPenSession(){
  const mytableobspen = document.querySelector("#listObsPenTable>tbody");
  // Pegar o conteudo de tbody e gravar em uma variável de sessão
  console.log(mytableobspen.innerHTML)
  sessionStorage.setItem('obspen', mytableobspen.innerHTML);
}

function setBoxSeiSession(){
  // Pega o conteudo da div com id = listContainer-new e grava em uma variável de sessão
  const listContainer = document.getElementById("listContainer-new");
  sessionStorage.setItem('sei', listContainer.innerHTML);
  
}

function clearSession(){
  sessionStorage.clear();
  location.reload();
}

function getAllValues() {
  // Configura o value de cada campo do formulário de id "form-etapas" com o valor armazenado em sessionStorage
  document.querySelectorAll("#form-etapas .changeble-item").forEach((item) => {
    item.value = sessionStorage.getItem(item.id);
  });
  // Pega o conteudo que está dentro da variavel de sessão sei e insere dentro da div com id = listContainer-new
  document.getElementById("listContainer-new").innerHTML = sessionStorage.getItem('sei');

  // Pega o conteudo que está dentro da variavel de sessão equipamentos e insere dentro da tbody com id = main-table
  document.getElementById("main-table").getElementsByTagName("tbody")[0].innerHTML = sessionStorage.getItem('equipamentos');

  // Pega o conteudo que está dentro da variavel de sessão cronograma e insere dentro da tbody com id = listTaskTable
  document.getElementById("listTaskTable").getElementsByTagName("tbody")[0].innerHTML = sessionStorage.getItem('cronograma');

  // Pega o conteudo que está dentro da variavel de sessão obspen e insere dentro da tbody com id = listObsPenTable
  document.getElementById("listObsPenTable").getElementsByTagName("tbody")[0].innerHTML = sessionStorage.getItem('obspen');
}

</script>
{% endblock %}

